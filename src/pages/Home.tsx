import { useNavigate } from "react-router-dom";
import axios from "axios";
import { useState } from "react";
import { useAuthStore } from "../store/use-auth";

const Home = () => {
  console.log("inside home!");
  const navigate = useNavigate();
  const isLoggedIn = useAuthStore((state) => state.isLoggedIn);
  const userStatus = useAuthStore((state) => state.userStatus);
  const setAuthState = useAuthStore((state) => state.setAuthState);
  const [count, setCount] = useState<number>(0);
  const incrementCount = () => {
    setCount((prevCount) => {
      return prevCount + 1;
    });
  };
  const accessProtectedHandler = async () => {
    axios
      .get("http://localhost:8080/protected", { withCredentials: true })
      .then((response) => {
        console.log(response);
      })
      .catch((_err) => {
        console.log("something went wrong while trying to access protected route!");
      });
  };
  //TODO: Handle possible errors. 
  const logOutHandler = async () => {
    await axios.get("http://localhost:8080/auth/logout", {
      withCredentials: true,
    });
    navigate(0);
    setAuthState(false, "guest");
  };

  return (
    <div>
      <div>
        <button className="text-slate-100" onClick={accessProtectedHandler}>
          Access Protected
        </button>
      </div>
      <div>
        <button className="text-slate-100" onClick={logOutHandler}>
          Logout
        </button>
      </div>
      <div className="text-slate-200">
        <p>
          You are {isLoggedIn ? "logged in" : "not logged in,"} and have a user
          status of {userStatus}
        </p>
        <p className="text-slate-200">Count = {count}</p>
        <button className="text-slate-100" onClick={incrementCount}>
          increment count
        </button>
      </div>
    </div>
  );
};

export default Home;
